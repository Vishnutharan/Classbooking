<div class="profile-container">
  <div class="header">
    <h1>ğŸ‘¤ Manage Profile</h1>
    <p>Update your account information</p>
  </div>

  <div *ngIf="isLoading" class="loading-spinner"></div>

  <div class="profile-content" *ngIf="!isLoading">
    <div class="section profile-pic-section">
      <h2>ğŸ“¸ Profile Picture</h2>
      <div class="pic-container">
        <img [src]="profilePicture || 'https://via.placeholder.com/150'" alt="Profile" class="profile-pic">
        <div class="pic-upload" (dragover)="onDragOver($event)" (drop)="onDrop($event)">
          <p>ğŸ“¤ Drag & drop or click to upload</p>
          <input type="file" accept="image/*" (change)="onProfilePictureChange($event)" #fileInput hidden>
          <button type="button" class="btn-upload" (click)="fileInput.click()">Choose Image</button>
        </div>
      </div>
    </div>

    <form [formGroup]="profileForm" (ngSubmit)="saveProfile()" class="section">
      <h2>ğŸ“ Basic Information</h2>
      <div class="form-row">
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" formControlName="fullName" class="form-input">
          <span class="error" *ngIf="profileForm.get('fullName')?.invalid && profileForm.get('fullName')?.touched">
            Name required (min 2 chars)
          </span>
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" formControlName="email" class="form-input">
          <small>Email cannot be changed</small>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Phone Number</label>
          <input type="tel" formControlName="phoneNumber" class="form-input">
        </div>
      </div>

      <div *ngIf="currentUser?.role === 'Teacher'" class="form-row">
        <div class="form-group">
          <label>Hourly Rate (LKR)</label>
          <input type="number" formControlName="hourlyRate" class="form-input" min="0">
        </div>
        <div class="form-group">
          <label>Experience (Years)</label>
          <input type="number" formControlName="experienceYears" class="form-input" min="0">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group form-full">
          <label>Bio</label>
          <textarea formControlName="bio" class="form-input textarea" rows="4"></textarea>
        </div>
      </div>

      <button type="submit" class="btn-primary" [disabled]="isSaving || profileForm.invalid">
        {{ isSaving ? 'ğŸ’¾ Saving...' : 'ğŸ’¾ Save Changes' }}
      </button>
    </form>

    <form [formGroup]="passwordForm" (ngSubmit)="changePassword()" class="section">
      <h2>ğŸ” Change Password</h2>
      <div class="form-row">
        <div class="form-group">
          <label>Current Password</label>
          <input type="password" formControlName="currentPassword" class="form-input">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>New Password</label>
          <input type="password" formControlName="newPassword" class="form-input">
          <small>Min 8 characters</small>
        </div>
        <div class="form-group">
          <label>Confirm Password</label>
          <input type="password" formControlName="confirmPassword" class="form-input">
        </div>
      </div>
      <button type="submit" class="btn-secondary" [disabled]="isSaving || passwordForm.invalid">
        ğŸ”‘ Change Password
      </button>
    </form>

    <div class="section">
      <h2>âœ‰ï¸ Email Verification</h2>
      <div class="status-box">
        <p><strong>Email:</strong> {{ currentUser?.email }}</p>
        <span class="badge verified">âœ“ Verified</span>
        <button type="button" class="btn-link">Resend Verification</button>
      </div>
    </div>

    <form [formGroup]="privacyForm" (ngSubmit)="savePrivacy()" class="section">
      <h2>ğŸ”’ Privacy Settings</h2>
      <div class="checkbox-group">
        <label>
          <input type="checkbox" formControlName="profilePublic">
          <span>Make my profile public</span>
        </label>
        <label>
          <input type="checkbox" formControlName="showAvailability">
          <span>Show my availability</span>
        </label>
        <label>
          <input type="checkbox" formControlName="allowNotifications">
          <span>Allow notifications</span>
        </label>
      </div>
      <button type="submit" class="btn-secondary" [disabled]="isSaving">
        ğŸ’¾ Save Privacy Settings
      </button>
    </form>

    <div class="section danger">
      <h2>âš ï¸ Danger Zone</h2>
      <p>Deleting your account is permanent and cannot be undone.</p>
      <button type="button" class="btn-danger" (click)="openDeleteModal()">
        ğŸ—‘ï¸ Delete Account
      </button>
    </div>
  </div>

  <div class="modal" *ngIf="showDeleteModal">
    <div class="modal-overlay" (click)="closeDeleteModal()"></div>
    <div class="modal-content">
      <h2>Delete Account?</h2>
      <p>This action cannot be undone. All your data will be permanently deleted.</p>
      <p>Type your email to confirm: <strong>{{ currentUser?.email }}</strong></p>
      
      <input type="text" [(ngModel)]="deleteConfirmEmail" class="form-input" placeholder="Confirm your email">
      
      <div class="modal-actions">
        <button class="btn cancel" (click)="closeDeleteModal()">Cancel</button>
        <button class="btn danger" (click)="confirmDelete()" 
          [disabled]="deleteConfirmEmail !== currentUser?.email">
          Delete Account
        </button>
      </div>
    </div>
  </div>
</div>